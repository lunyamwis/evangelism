
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>üìñ SDA Evangelism - Bible Work Module</title>

<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
  /* === RESET & BASE === */
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  html, body {
    height: 100%;
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg,#dae9ff,#a5c6ff);
    color: #102a5a;
    scroll-behavior: smooth;
  }
  body, button, input, select, textarea {
    font-size: 1rem;
    font-weight: 600;
  }
  button {
    cursor: pointer;
    user-select: none;
    border: none;
    background: #254e94;
    color: white;
    border-radius: 10px;
    padding: 0.55rem 1.35rem;
    transition: background-color 0.3s ease, box-shadow 0.3s ease;
  }
  button:hover, button:focus {
    background-color: #1c3472;
    box-shadow: 0 0 12px #1c347299;
    outline: none;
  }
  a {
    color: #254e94;
    text-decoration: none;
    transition: text-decoration 0.3s ease;
  }
  a:hover, a:focus {
    text-decoration: underline;
  }
  h1,h2,h3,h4,h5,h6 {
    font-weight: 900;
  }
  p, label {
    line-height: 1.4;
  }
  /* Scrollbars */
  ::-webkit-scrollbar {
    width: 14px; height: 14px;
  }
  ::-webkit-scrollbar-thumb {
    background-color: #6b8adacc;
    border-radius: 14px;
    border: 4px solid #d6e4ff;
  }
  ::-webkit-scrollbar-thumb:hover {
    background-color: #284c9bff;
  }
  ::-webkit-scrollbar-track {
    background-color: #d6e4ff;
  }

  /* LAYOUT GRID */
  body {
    display: grid;
    grid-template-columns: 220px 1fr 360px;
    grid-template-rows: 64px 1fr 100px;
    grid-template-areas:
      "sidebar header header"
      "sidebar main assistant"
      "sidebar footer footer";
    height: 100vh;
    gap: 8px;
  }

  nav#sidebar {
    grid-area: sidebar;
    background-color: #223f76;
    color: #c9d6ff;
    display: flex;
    flex-direction: column;
    padding: 1rem 12px;
    box-shadow: inset 4px 0 14px rgba(0,0,0,0.3);
  }
  nav#sidebar button {
    background: transparent;
    color: #aebff9;
    border: none;
    padding: 14px 12px;
    font-weight: 700;
    font-size: 1.05rem;
    cursor: pointer;
    user-select: none;
    text-align: left;
    margin-bottom: 8px;
    border-radius: 10px;
    transition: background-color 0.3s ease;
  }
  nav#sidebar button:hover,
  nav#sidebar button:focus,
  nav#sidebar button.active {
    background-color: #2c59ad;
    color: white;
    outline: none;
  }

  header#header {
    grid-area: header;
    background: linear-gradient(90deg, #243c7d, #1b2f5f);
    color: white;
    font-weight: 900;
    font-size: 1.4rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0 2rem;
    user-select: none;
    box-shadow: 0 0 18px #18294eaa;
  }
  header#header button {
    background: #b33c3c;
    padding: 0.5rem 1rem;
    border-radius: 10px;
    font-weight: 800;
  }
  header#header button:hover {
    background: #821f1f;
  }

  footer#footer {
    grid-area: footer;
    background-color: #284a88cc;
    color: white;
    font-weight: 700;
    font-size: 0.9rem;
    display: flex;
    justify-content: center;
    align-items: center;
    user-select: none;
  }

  main#main {
    grid-area: main;
    background: white;
    border-radius: 24px;
    padding: 2rem 3rem;
    overflow-y: auto;
    box-shadow: inset 0 0 18px #9ab0de55;
    display: flex;
    flex-direction: column;
  }

  aside#assistant {
    grid-area: assistant;
    background: #e4ecffcc;
    border-left: 3px solid #254e94;
    padding: 1rem 1.5rem;
    font-family: monospace;
    font-weight: 600;
    display: flex;
    flex-direction: column;
  }
  #assistantHeader {
    font-weight: 700;
    font-size: 1.28rem;
    color: #1a315e;
    margin-bottom: 1rem;
    user-select: none;
  }
  #chatWindow {
    flex-grow: 1;
    background: white;
    border-radius: 16px;
    border: 2px solid #6a8fd9;
    overflow-y: auto;
    padding: 14px 18px;
    font-size: 0.9rem;
    color: #1a315e;
  }
  .chat-message {
    max-width: 80%;
    line-height: 1.3;
    margin-bottom: 14px;
    padding: 9px 14px;
    border-radius: 24px;
    white-space: pre-wrap;
    word-wrap: break-word;
  }
  .chat-message.user {
    background: #a3b6ffcc;
    color: #0f2162;
    align-self: flex-end;
  }
  .chat-message.ai {
    background: #badaffcc;
    color: #0e2a54;
    align-self: flex-start;
  }
  #inputArea {
    margin-top: 12px;
    display: flex;
    gap: 0.5rem;
  }
  #userInput {
    flex-grow: 1;
    border-radius: 24px;
    border: 2px solid #254e94;
    padding: 0.5rem 1rem;
    font-family: inherit;
    font-weight: 600;
    font-size: 1rem;
  }
  #sendBtn, #voiceToggleBtn {
    width: 46px;
    height: 46px;
    border-radius: 50%;
    background: #254e94;
    color: white;
    font-weight: 700;
    font-size: 1.3rem;
    transition: background-color 0.3s ease;
  }
  #sendBtn:hover, #voiceToggleBtn:hover,
  #sendBtn:focus, #voiceToggleBtn:focus {
    background-color: #183270;
    outline: none;
  }

  /* Section Start */
  section.module-section {
    margin-bottom: 28px;
  }
  h3 {
    font-weight: 900;
    margin-bottom: 12px;
    user-select: none;
  }
  label {
    margin-top: 14px;
    display: block;
    font-weight: 700;
  }
  input[type="text"], input[type="date"], input[type="time"], select, textarea {
    width: 100%;
    padding: 10px 14px;
    border-radius: 14px;
    border: 2px solid #a3b5e6;
    font-weight: 600;
    font-family: inherit;
    font-size: 1rem;
    transition: border-color 0.3s ease;
  }
  input[type="text"]:focus, input[type="date"]:focus, input[type="time"]:focus, select:focus, textarea:focus {
    border-color: #254e94;
    box-shadow: 0 0 12px #254e94a8;
    outline: none;
  }
  textarea {
    resize: vertical;
    min-height: 90px;
    font-style: italic;
  }
  button.btn-primary {
    margin-top: 18px;
    padding: 0.7rem 1.6rem;
    border-radius: 18px;
  }
  /* Tables for study schedule and teams */
  table {
    width: 100%;
    border-collapse: collapse;
    font-family: monospace;
    margin-top: 14px;
  }
  th, td {
    border: 1.3px solid #9ab1e6;
    padding: 0.55rem 1rem;
    text-align: left;
  }
  th {
    background-color: #bcc9fa;
    color: #1f3768;
    user-select: none;
    font-weight: 700;
  }
  tbody tr:nth-child(even) {
    background-color: #d8e2fc;
  }
  tbody tr:hover {
    background-color: #c4d1fecc;
    cursor: pointer;
  }
</style>
</head>
<body>

<nav id="sidebar" role="navigation" aria-label="Main Navigation" tabindex="0" aria-live="polite">
  <button class="tab-btn active" id="tab-schedule" aria-selected="true" role="tab" aria-controls="panel-schedule" aria-label="Bible Study Schedule">üìÖ Study Schedule</button>
  <button class="tab-btn" id="tab-materials" aria-selected="false" role="tab" aria-controls="panel-materials" aria-label="Lesson Materials">üìö Lesson Materials</button>
  <button class="tab-btn" id="tab-teams" aria-selected="false" role="tab" aria-controls="panel-teams" aria-label="Outreach Teams">üë• Outreach Teams</button>
  <button class="tab-btn" id="tab-visits" aria-selected="false" role="tab" aria-controls="panel-visits" aria-label="Visit Logs">‚úçÔ∏è Visit Logs</button>
  <button class="tab-btn" id="tab-progress" aria-selected="false" role="tab" aria-controls="panel-progress" aria-label="Study Progress">üìà Progress Tracker</button>
</nav>

<header id="header" role="banner" aria-label="Application Header">
  SDA Evangelism Bible Work Module
  <button id="btnReset" aria-label="Reset All Data" title="Reset All Data">Reset App</button>
</header>

<main id="main" role="main" tabindex="0">

  <!-- Study Schedule Panel -->
  <section id="panel-schedule" class="module-section panel active" role="tabpanel" tabindex="0" aria-labelledby="tab-schedule" aria-hidden="false">
    <h2>Bible Study Scheduling</h2>
    <form id="formSchedule" aria-label="Add Bible Study">
      <label for="studyDate">Date</label>
      <input type="date" id="studyDate" required />
      <label for="studyTime">Time</label>
      <input type="time" id="studyTime" required />
      <label for="studyLocation">Location</label>
      <input type="text" id="studyLocation" placeholder="Address or Venue" required />
      <label for="studyTopic">Study Topic</label>
      <input type="text" id="studyTopic" placeholder="e.g. The Sabbath" required />
      <label for="studyNotes">Notes</label>
      <textarea id="studyNotes" rows="3" placeholder="Optional notes"></textarea>
      <button type="submit" class="btn-primary" aria-label="Add Bible Study">Add Study</button>
    </form>
    <h3>Upcoming Bible Studies</h3>
    <table id="scheduleTable" aria-live="polite" aria-label="Bible study schedule table">
      <thead>
        <tr><th>Date</th><th>Time</th><th>Location</th><th>Topic</th><th>Notes</th><th>Actions</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- Lesson Materials Panel -->
  <section id="panel-materials" class="module-section panel" role="tabpanel" tabindex="0" aria-labelledby="tab-materials" aria-hidden="true" hidden>
    <h2>Sabbath School Lesson Materials</h2>
    <form id="formMaterial" aria-label="Add Lesson Material">
      <label for="materialTitle">Title</label>
      <input id="materialTitle" type="text" placeholder="Material Title" required />
      <label for="materialAuthor">Author</label>
      <input id="materialAuthor" type="text" placeholder="Author Name" />
      <label for="materialLink">Resource Link (optional)</label>
      <input id="materialLink" type="url" placeholder="https://example.com" />
      <label for="materialNotes">Notes</label>
      <textarea id="materialNotes" rows="3" placeholder="Additional notes"></textarea>
      <button type="submit" class="btn-primary" aria-label="Add Lesson Material">Add Material</button>
    </form>
    <h3>Available Materials</h3>
    <table id="materialsTable" aria-live="polite" aria-label="Lesson materials table">
      <thead>
        <tr><th>Title</th><th>Author</th><th>Link</th><th>Notes</th><th>Actions</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- Outreach Teams Panel -->
  <section id="panel-teams" class="module-section panel" role="tabpanel" tabindex="0" aria-labelledby="tab-teams" aria-hidden="true" hidden>
    <h2>Evangelism Team Management</h2>
    <form id="formTeam" aria-label="Add Team Member">
      <label for="teamMemberName">Name</label>
      <input id="teamMemberName" type="text" placeholder="Full Name" required />
      <label for="teamMemberRole">Role</label>
      <input id="teamMemberRole" type="text" placeholder="e.g. Leader, Volunteer" required />
      <label for="teamMemberContact">Contact</label>
      <input id="teamMemberContact" type="text" placeholder="Phone or Email" />
      <button type="submit" class="btn-primary" aria-label="Add Team Member">Add Member</button>
    </form>
    <h3>Current Team Members</h3>
    <table id="teamTable" aria-live="polite" aria-label="Evangelism team table">
      <thead>
        <tr><th>Name</th><th>Role</th><th>Contact</th><th>Actions</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- Visit Logs Panel -->
  <section id="panel-visits" class="module-section panel" role="tabpanel" tabindex="0" aria-labelledby="tab-visits" aria-hidden="true" hidden>
    <h2>Outreach Visit Logs</h2>
    <form id="formVisit" aria-label="Add Visit Log">
      <label for="visitDate">Date of Visit</label>
      <input type="date" id="visitDate" required />
      <label for="visitAddress">Address / Location</label>
      <input type="text" id="visitAddress" placeholder="Where the visit took place" required />
      <label for="visitContact">Contact Person</label>
      <input type="text" id="visitContact" placeholder="Name of person visited" required />
      <label for="visitNotes">Visit Notes</label>
      <textarea id="visitNotes" rows="3" placeholder="Summary of the visit"></textarea>
      <button type="submit" class="btn-primary" aria-label="Add Visit Log">Log Visit</button>
    </form>
    <h3>Visit History</h3>
    <table id="visitsTable" aria-live="polite" aria-label="Visit logs table">
      <thead>
        <tr><th>Date</th><th>Location</th><th>Contact</th><th>Notes</th><th>Actions</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <!-- Progress Tracker Panel -->
  <section id="panel-progress" class="module-section panel" role="tabpanel" tabindex="0" aria-labelledby="tab-progress" aria-hidden="true" hidden>
    <h2>Study & Outreach Progress Tracker</h2>
    <p>Visual summaries and progress charts of ongoing Bible work.</p>
    <canvas id="progressChart" width="700" height="350" aria-label="Bible Work Progress Chart" role="img"></canvas>
  </section>

</main>

<script>
(() => {
  const tabs = document.querySelectorAll('nav#sidebar button.tab-btn');
  const panels = document.querySelectorAll('main#main section.panel');

  // Bible Study Schedule Elements
  const formSchedule = document.getElementById('formSchedule');
  const scheduleTableBody = document.querySelector('#scheduleTable tbody');

  // Lesson Materials Elements
  const formMaterial = document.getElementById('formMaterial');
  const materialsTableBody = document.querySelector('#materialsTable tbody');

  // Evangelism Teams Elements
  const formTeam = document.getElementById('formTeam');
  const teamTableBody = document.querySelector('#teamTable tbody');

  // Visits Elements
  const formVisit = document.getElementById('formVisit');
  const visitsTableBody = document.querySelector('#visitsTable tbody');

  // Progress Tracker
  const progressChartCtx = document.getElementById('progressChart').getContext('2d');
  let progressChart;

  // Reset button
  const btnReset = document.getElementById('btnReset');

  /* Persistent data keys */
  const STORAGE_KEYS = {
    schedule: 'bible_work_schedule',
    materials: 'bible_work_materials',
    team: 'bible_work_team',
    visits: 'bible_work_visits'
  };

  let schedule = [];
  let materials = [];
  let team = [];
  let visits = [];

  // Utility to save all data
  function saveAll() {
    localStorage.setItem(STORAGE_KEYS.schedule, JSON.stringify(schedule));
    localStorage.setItem(STORAGE_KEYS.materials, JSON.stringify(materials));
    localStorage.setItem(STORAGE_KEYS.team, JSON.stringify(team));
    localStorage.setItem(STORAGE_KEYS.visits, JSON.stringify(visits));
  }

  // Load all data
  function loadAll() {
    schedule = JSON.parse(localStorage.getItem(STORAGE_KEYS.schedule)) || [];
    materials = JSON.parse(localStorage.getItem(STORAGE_KEYS.materials)) || [];
    team = JSON.parse(localStorage.getItem(STORAGE_KEYS.team)) || [];
    visits = JSON.parse(localStorage.getItem(STORAGE_KEYS.visits)) || [];
  }

  // Tab switching logic
  tabs.forEach(tab => {
    tab.addEventListener('click', () => {
      tabs.forEach(t => t.classList.remove('active'));
      tab.classList.add('active');
      const target = tab.id.replace('tab-', 'panel-');
      panels.forEach(p => {
        if (p.id === target) {
          p.classList.add('active');
          p.hidden = false;
          p.focus();
          if (p.id === 'panel-progress') renderProgressChart();
        } else {
          p.classList.remove('active');
          p.hidden = true;
        }
      });
    });
  });

  // Bible Study Scheduling handlers
  formSchedule.addEventListener('submit', e => {
    e.preventDefault();
    const date = formSchedule.studyDate.value;
    const time = formSchedule.studyTime.value;
    const location = formSchedule.studyLocation.value.trim();
    const topic = formSchedule.studyTopic.value.trim();
    const notes = formSchedule.studyNotes.value.trim();

    if (!date || !time || !location || !topic) {
      alert('Please fill all required fields.');
      return;
    }

    schedule.push({ id: Date.now().toString(), date, time, location, topic, notes });
    saveAll();
    formSchedule.reset();
    renderScheduleTable();
  });

  function renderScheduleTable() {
    scheduleTableBody.innerHTML = '';
    if (schedule.length === 0) {
      scheduleTableBody.insertAdjacentHTML('beforeend', `<tr><td colspan="6" style="text-align:center;">No scheduled studies yet.</td></tr>`);
      return;
    }
    schedule.sort((a, b) => new Date(a.date + 'T' + a.time) - new Date(b.date + 'T' + b.time));
    for (const s of schedule) {
      scheduleTableBody.insertAdjacentHTML('beforeend', `
        <tr>
          <td>${s.date}</td>
          <td>${s.time}</td>
          <td>${sanitize(s.location)}</td>
          <td>${sanitize(s.topic)}</td>
          <td>${sanitize(s.notes)}</td>
          <td><button data-id="${s.id}" class="btn-delete">Delete</button></td>
        </tr>`);
    }
  }

  scheduleTableBody.addEventListener('click', e => {
    if (e.target.classList.contains('btn-delete')) {
      const id = e.target.dataset.id;
      schedule = schedule.filter(s => s.id !== id);
      saveAll();
      renderScheduleTable();
    }
  });

  // Lesson Materials handlers
  formMaterial.addEventListener('submit', e => {
    e.preventDefault();
    const title = formMaterial.materialTitle.value.trim();
    if (!title) return alert('Material title is required.');
    const author = formMaterial.materialAuthor.value.trim();
    const link = formMaterial.materialLink.value.trim();
    const notes = formMaterial.materialNotes.value.trim();
    materials.push({ id: Date.now().toString(), title, author, link, notes });
    saveAll();
    formMaterial.reset();
    renderMaterialsTable();
  });

  function renderMaterialsTable() {
    materialsTableBody.innerHTML = '';
    if (materials.length === 0) {
      materialsTableBody.insertAdjacentHTML('beforeend', `<tr><td colspan="5" style="text-align:center;">No materials added yet.</td></tr>`);
      return;
    }
    for (const m of materials) {
      materialsTableBody.insertAdjacentHTML('beforeend', `
      <tr>
        <td>${sanitize(m.title)}</td>
        <td>${sanitize(m.author)}</td>
        <td>${m.link ? `<a href="${sanitize(m.link)}" target="_blank" rel="noopener">Link</a>` : ''}</td>
        <td>${sanitize(m.notes)}</td>
        <td><button data-id="${m.id}" class="btn-delete">Delete</button></td>
      </tr>`);
    }
  }

  materialsTableBody.addEventListener('click', e => {
    if (e.target.classList.contains('btn-delete')) {
      const id = e.target.dataset.id;
      materials = materials.filter(m => m.id !== id);
      saveAll();
      renderMaterialsTable();
    }
  });

  // Outreach Teams handlers
  formTeam.addEventListener('submit', e => {
    e.preventDefault();
    const name = formTeam.teamMemberName.value.trim();
    const role = formTeam.teamMemberRole.value.trim();
    if(!name || !role) return alert('Name and Role are required.');
    const contact = formTeam.teamMemberContact.value.trim();
    team.push({ id: Date.now().toString(), name, role, contact });
    saveAll();
    formTeam.reset();
    renderTeamTable();
  });

  function renderTeamTable() {
    teamTableBody.innerHTML = '';
    if (team.length === 0) {
      teamTableBody.insertAdjacentHTML('beforeend', `<tr><td colspan="4" style="text-align:center;">No team members added yet.</td></tr>`);
      return;
    }
    for (const t of team) {
      teamTableBody.insertAdjacentHTML('beforeend', `
      <tr>
        <td>${sanitize(t.name)}</td>
        <td>${sanitize(t.role)}</td>
        <td>${sanitize(t.contact)}</td>
        <td><button data-id="${t.id}" class="btn-delete">Delete</button></td>
      </tr>`);
    }
  }

  teamTableBody.addEventListener('click', e => {
    if (e.target.classList.contains('btn-delete')) {
      const id = e.target.dataset.id;
      team = team.filter(t => t.id !== id);
      saveAll();
      renderTeamTable();
    }
  });

  // Visit Logs handlers
  formVisit.addEventListener('submit', e => {
    e.preventDefault();
    const date = formVisit.visitDate.value;
    const location = formVisit.visitAddress.value.trim();
    const contactPerson = formVisit.visitContact.value.trim();
    if(!date || !location || !contactPerson) return alert('Date, Location, and Contact Person are required.');
    const notes = formVisit.visitNotes.value.trim();
    visits.push({ id: Date.now().toString(), date, location, contactPerson, notes });
    saveAll();
    formVisit.reset();
    renderVisitsTable();
  });

  function renderVisitsTable(){
    visitsTableBody.innerHTML = '';
    if (visits.length === 0) {
      visitsTableBody.insertAdjacentHTML('beforeend', `<tr><td colspan="5" style="text-align:center;">No visits logged yet.</td></tr>`);
      return;
    }
    visits.sort((a, b) => new Date(b.date) - new Date(a.date));
    for(const v of visits){
      visitsTableBody.insertAdjacentHTML('beforeend', `
        <tr>
          <td>${v.date}</td>
          <td>${sanitize(v.location)}</td>
          <td>${sanitize(v.contactPerson)}</td>
          <td>${sanitize(v.notes)}</td>
          <td><button data-id="${v.id}" class="btn-delete">Delete</button></td>
        </tr>`);
    }
  }

  visitsTableBody.addEventListener('click', e=>{
    if(e.target.classList.contains('btn-delete')){
      const id = e.target.dataset.id;
      visits = visits.filter(v => v.id !== id);
      saveAll();
      renderVisitsTable();
    }
  });

  // Progress Tracker chart rendering
  function renderProgressChart(){
    if(progressChart) progressChart.destroy();

    // Example: count studies and visits per month for last 6 months
    const months = [];
    const studiesCount = [];
    const visitsCount = [];
    const now = new Date();

    for(let i=5; i>=0; i--){
      const dt = new Date(now.getFullYear(), now.getMonth() - i, 1);
      const label = dt.toLocaleString('default', {month: 'short', year: 'numeric'});
      months.push(label);

      let sc = 0, vc = 0;

      schedule.forEach(s => {
        if(s.date.startsWith(dt.toISOString().slice(0,7))) sc++;
      });
      visits.forEach(v => {
        if(v.date.startsWith(dt.toISOString().slice(0,7))) vc++;
      });

      studiesCount.push(sc);
      visitsCount.push(vc);
    }

    progressChart = new Chart(progressChartCtx, {
      type: 'bar',
      data: {
        labels: months,
        datasets: [
          {label: 'Scheduled Studies', data: studiesCount, backgroundColor: 'rgba(37, 78, 148, 0.8)'},
          {label: 'Outreach Visits', data: visitsCount, backgroundColor: 'rgba(100, 131, 189, 0.8)'}
        ]
      },
      options: {
        responsive: true,
        scales: { y: { beginAtZero: true, stepSize: 1 } },
        plugins: { legend: { position: 'top' } }
      }
    });
  }

  // Reset all data button
  btnReset.addEventListener('click', () => {
    if(confirm('Are you sure you want to reset all data? This cannot be undone.')){
      schedule = [];
      materials = [];
      team = [];
      visits = [];
      saveAll();
      renderAll();
    }
  });

  // Rendering all modules after loading or reset
  function renderAll(){
    renderScheduleTable();
    renderMaterialsTable();
    renderTeamTable();
    renderVisitsTable();
    renderProgressChart();
  }

  // INITIAL LOAD
  loadAll();
  renderAll();

})();
</script>

</body>
</html>
